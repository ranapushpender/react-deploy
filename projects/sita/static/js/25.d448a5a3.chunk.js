(this["webpackJsonpatko-mvp-frontend"]=this["webpackJsonpatko-mvp-frontend"]||[]).push([[25],{3956:function(e,t,a){},4003:function(e,t,a){"use strict";a.r(t);a(38);var l=a(21),r=a.n(l),n=(a(118),a(54)),i=a.n(n),c=(a(204),a(52)),u=a.n(c),s=a(1),o=a.n(s),d=a(6),f=a(19),m=a(18),b=a(2),h=a(8),g=(a(149),a(69)),p=a.n(g),D=a(0),S=a.n(D),y=a(15),v=a.n(y),O=a(57),N=a(28),E=a(10),x=a(13),j=(a(401),a(231)),T=a.n(j),A=(a(444),a(176)),F=a.n(A),L=a(22),V=a(1042),C=function(e){var t=p.a.Text;return S.a.createElement(S.a.Fragment,null,S.a.createElement(T.a,{className:"mt-30"},S.a.createElement(F.a,{span:17},S.a.createElement(t,{className:"bold mb-10"},"Arrival Date"),S.a.createElement("div",{id:"arrival-info",className:"form-grid grid-3 mt-10"},S.a.createElement(x.b,{component:L.a,getPopupContainer:function(){return document.getElementById("arrival-info")},name:"finalScheduleArrivalDate",label:"Arrival Date",disabledDate:function(e){return e&&e.isBefore(v()(),"day")},value:e.finalScheduleArrivalDate?v()(e.finalScheduleArrivalDate):"",format:"LL",onChange:function(t){if(v()(t).isSameOrAfter(v()(e.finalScheduleDepartureDate)))e.setFieldValue("finalScheduleArrivalDate",t);else{e.setFieldValue("finalScheduleArrivalDate",t);var a=v()(e.finalScheduleDepartureDate).diff(t,"days");if(e.selectedCountriesAllRegions.length>0){var l=e.selectedCountriesAllRegions[0];e.setFieldValue("numberofNights[".concat(l.code,"]"),a),e.setTotalDuration(a)}}},validate:function(t){var a="";return t||(a="Arrival date is required"),v()(t).isSameOrAfter(v()(e.finalScheduleDepartureDate))&&(a="Arrival date cannot be ahead of departure date."),a}}),S.a.createElement(x.b,{component:L.b,label:"Flight Number (Optional)",value:e.finalScheduleArrivalFlight,name:"finalScheduleArrivalFlight",type:"text",autoComplete:"off"}))),S.a.createElement(F.a,{span:7,id:"arrival-time",className:"pl-20"},S.a.createElement(t,{className:"bold mb-10"},"Arrival Time (Optional)"),S.a.createElement("div",{className:"mt-15"},S.a.createElement(V.a,{propVal:e.finalScheduleArrivalTime,setFieldValue:e.setFieldValue,field:"finalScheduleArrivalTime",popupContainerId:"arrival-time"})))),S.a.createElement(T.a,{className:"mt-30"},S.a.createElement(F.a,{span:17},S.a.createElement(t,{className:"bold mb-10"},"Departure Date"),S.a.createElement("div",{id:"departure-info",className:"form-grid grid-3 mt-10"},S.a.createElement(x.b,{component:L.a,getPopupContainer:function(){return document.getElementById("departure-info")},name:"finalScheduleDepartureDate",label:"Departure Date",value:e.finalScheduleDepartureDate?v()(e.finalScheduleDepartureDate):"",defaultPickerValue:e.finalScheduleArrivalDate?v()(e.finalScheduleArrivalDate):"",format:"LL",validateOnBlur:!1,onChange:function(t){e.setFieldValue("finalScheduleDepartureDate",t);var a=v()(t).diff(e.finalScheduleArrivalDate,"days");if(e.selectedCountriesAllRegions.length>0){var l=e.selectedCountriesAllRegions[0];e.setFieldValue("numberofNights[".concat(l.code,"]"),a),e.setTotalDuration(a)}},disabledDate:function(t){return t&&t<v()(e.finalScheduleArrivalDate).endOf("day")},validate:function(e){var t="";return e||(t="Departure date is required"),t}}),S.a.createElement(x.b,{component:L.b,label:"Flight Number (Optional)",value:e.finalScheduleDepartureFlight,name:"finalScheduleDepartureFlight",type:"text",autoComplete:"off"}))),S.a.createElement(F.a,{span:7,className:"pl-20"},S.a.createElement(t,{className:"bold mb-10"},"Departure Time (Optional)"),S.a.createElement("div",{id:"departure-time",className:"mt-15"},S.a.createElement(V.a,{propVal:e.finalScheduleDepartureTime,setFieldValue:e.setFieldValue,field:"finalScheduleDepartureTime",popupContainerId:"departure-time"})))))},k=function(e){var t=p.a.Text;return S.a.createElement("div",{className:"flexible-container"},S.a.createElement(t,{className:"bold mb-10"},"Nights & Tentative Schedule"),S.a.createElement("div",{id:"flexible-schedule",className:"form-grid grid-3 mt-10"},S.a.createElement(x.b,{component:L.b,label:"Number of nights ",value:e.flexibleScheduleLengthOfStay,name:"flexibleScheduleLengthOfStay",type:"number",autoComplete:"off",onChange:function(t){if(e.setFieldValue("flexibleScheduleLengthOfStay",Math.abs(t.target.value)),e.selectedCountriesAllRegions.length>0){var a=e.selectedCountriesAllRegions[0];e.setFieldValue("numberofNights[".concat(a.code,"]"),Math.abs(t.target.value))}}}),S.a.createElement(x.b,{component:L.a,getPopupContainer:function(){return document.getElementById("flexible-schedule")},name:"flexibleScheduleStartDate",label:"Tentative Start Date",value:e.flexibleScheduleStartDate?v()(e.flexibleScheduleStartDate):"",format:"LL",disabledDate:function(e){return e&&e.isBefore(v()(),"day")}})))},q=a(212),R=a(11),H=[{label:"Finalized Dates",value:"final"},{label:"Flexible Date",value:"flexible"}],Y=(a(3956),a(25)),I=Y.f().shape({scheduleType:Y.g().nullable().required("Schedule type is required"),finalScheduleArrivalDate:Y.g().nullable().when("scheduleType",(function(e,t){return"final"===e?t.required("Arrival Date is required"):t})),finalScheduleDepartureDate:Y.g().nullable().when("scheduleType",(function(e,t){return"final"===e?t.required("Departure date is required"):t})),flexibleScheduleStartDate:Y.g().nullable().when("scheduleType",(function(e,t){return"flexible"===e?t.required("Tentative start date is required"):t})),flexibleScheduleLengthOfStay:Y.e().nullable().when("scheduleType",(function(e,t){return"flexible"===e?t.required("Tentative length of stay date is required"):t}))}),w=a(14);var B=Object(N.b)((function(e){return{queryId:e.QueryDetails.queryId,stayDetails:e.QueryDetails.stayDetails,regionsList:e.QueryDetails.regionsList,countryRegionsData:e.QueryDetails.countryRegionsData}}),(function(e){return{getAllQueryDetailsData:Object(E.b)(q.h,e),getStayDetailsData:Object(E.b)(q.r,e),resetStayDetails:Object(E.b)(q.u,e),getAllCountryRegionsData:Object(E.b)(q.c,e),setStayDetailsData:Object(E.b)(q.z,e),getRegionsList:Object(E.b)(q.q,e),countryRegions:Object(E.b)(q.b,e)}}))((function(e){var t=Object(O.g)(),a=Object(R.q)().get("id"),l=p.a.Text,n=Object(D.useState)({scheduleType:"",finalScheduleArrivalDate:"",finalScheduleArrivalTime:"",finalScheduleDepartureDate:"",finalScheduleDepartureTime:"",finalScheduleArrivalFlight:"",finalScheduleDepartureFlight:"",flexibleScheduleStartDate:"",flexibleScheduleLengthOfStay:"",numberofNights:{IND:0,BTN:0,LKA:0,NPL:0}}),c=Object(h.a)(n,2),s=c[0],g=c[1],y=Object(D.useState)(0),N=Object(h.a)(y,2),E=N[0],j=N[1],T=Object(D.useState)(!1),A=Object(h.a)(T,2),F=A[0],V=A[1],q=Object(D.useState)([]),Y=Object(h.a)(q,2),B=Y[0],M=Y[1],P=Object(D.useState)([]),Q=Object(h.a)(P,2),z=Q[0],K=Q[1];Object(D.useEffect)((function(){e.getRegionsList("query"),e.getStayDetailsData(a),e.setVisitedForms((function(e){return e.concat("stay-details")}))}),[]),Object(D.useEffect)((function(){var t=e.stayDetails.countries.reduce((function(e,t){return e+t.lengthOfStay}),0);j(t),e.stayDetails.finalSchedule&&g((function(t){return Object(b.a)(Object(b.a)({},t),{},{scheduleType:e.stayDetails.scheduleType,finalScheduleArrivalDate:e.stayDetails.finalSchedule.arrivalDate?v()(e.stayDetails.finalSchedule.arrivalDate):"",finalScheduleDepartureDate:e.stayDetails.finalSchedule.departureDate?v()(e.stayDetails.finalSchedule.departureDate):"",finalScheduleArrivalTime:e.stayDetails.finalSchedule.arrivalTime?v()(e.stayDetails.finalSchedule.arrivalTime,"HH:mm").format("HH:mm A"):"",finalScheduleDepartureTime:e.stayDetails.finalSchedule.departureTime?v()(e.stayDetails.finalSchedule.departureTime,"HH:mm").format("HH:mm A"):"",finalScheduleArrivalFlight:e.stayDetails.finalSchedule.arrivalFlight,finalScheduleDepartureFlight:e.stayDetails.finalSchedule.departureFlight})})),e.stayDetails.flexibleSchedule&&g((function(t){return Object(b.a)(Object(b.a)({},t),{},{scheduleType:e.stayDetails.scheduleType,flexibleScheduleLengthOfStay:e.stayDetails.flexibleSchedule.lengthOfStay,flexibleScheduleStartDate:e.stayDetails.flexibleSchedule.startDate?v()(e.stayDetails.flexibleSchedule.startDate):""})}));var a=[];e.stayDetails.countries.forEach((function(e){var t={country:e.country.name,code:e.country.code,regions:e.availableRegions};a.push(t);var l=[];e.regions.forEach((function(e){return l.push(e.id)})),g((function(t){return Object(b.a)(Object(b.a)({},t),{},{numberofNights:Object(b.a)(Object(b.a)({},t.numberofNights),{},Object(m.a)({},e.country.code,e.lengthOfStay))})})),K((function(t){return Object(b.a)(Object(b.a)({},t),{},Object(m.a)({},e.country.code,l))}))})),M(a)}),[e.stayDetails]);var J=function(t,a,l){var r=Object.assign({},a),n=e.regionsList.find((function(e){return e.country.code===t}));if(l.target.checked){!function(e,t){var a=Object.assign({},e),l=0,r=0;for(var n in a.numberofNights)0!==a.numberofNights[n]&&(l+=Number(a.numberofNights[n]));"final"===e.scheduleType&&(r=v()(a.finalScheduleDepartureDate).diff(a.finalScheduleArrivalDate,"days"),a.numberofNights[t.country.code]=r-Number(l)),"flexible"===e.scheduleType&&(r=a.flexibleScheduleLengthOfStay,a.numberofNights[t.country.code]=r-Number(l)),g(a),j(r)}(a,n);var i=Object(f.a)(B);i.push({country:n.country.name,code:n.country.code,regions:n.regions}),M(i),K((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(m.a)({},n.country.code,[]))}))}if(!l.target.checked){var c=B.filter((function(e){return e.code!==t}));r.numberofNights[t]=0,M(c),g(r),delete z[t]}},G=function(){var l=Object(d.a)(o.a.mark((function l(r){var n,i,c,u,s;return o.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(B.length){l.next=3;break}return V(!0),l.abrupt("return");case 3:if(!((n=Object.keys(r.numberofNights).reduce((function(e,t){return e+Number(r.numberofNights[t])}),0))>E||n<E)){l.next=7;break}return Object(w.a)("info","Your trip must be equal to the total number of days of the trip"),l.abrupt("return");case 7:if(i=[],Object.keys(z).forEach((function(e){return i.push({country:e,lengthOfStay:r.numberofNights[e],regions:z[e]})})),c={scheduleType:r.scheduleType,countries:i},u=Object(b.a)(Object(b.a)({},c),{},{finalSchedule:{arrivalTime:r.finalScheduleArrivalTime?v()(r.finalScheduleArrivalTime,"HH:mm").format("HH:mm"):"",departureTime:r.finalScheduleDepartureTime?v()(r.finalScheduleDepartureTime,"HH:mm").format("HH:mm"):"",arrivalDate:r.finalScheduleArrivalDate?v()(r.finalScheduleArrivalDate).format("YYYY-MM-DD"):"",departureDate:r.finalScheduleDepartureDate?v()(r.finalScheduleDepartureDate).format("YYYY-MM-DD"):null,arrivalFlight:r.finalScheduleArrivalFlight,departureFlight:r.finalScheduleDepartureFlight}}),s=Object(b.a)(Object(b.a)({},c),{},{flexibleSchedule:{startDate:r.flexibleScheduleStartDate?v()(r.flexibleScheduleStartDate).format("YYYY-MM-DD"):"",lengthOfStay:r.flexibleScheduleLengthOfStay}}),"final"!==r.scheduleType){l.next=16;break}return l.next=16,e.setStayDetailsData(a,u);case 16:if("flexible"!==r.scheduleType){l.next=19;break}return l.next=19,e.setStayDetailsData(a,s);case 19:t.push({search:"?id=".concat(a,"&tab=preferences-and-inclusions")}),e.setCompletedForms((function(e){return e.concat("stay-details")})),e.setActiveTab("preferences-and-inclusions");case 22:case"end":return l.stop()}}),l)})));return function(e){return l.apply(this,arguments)}}();return S.a.createElement(S.a.Fragment,null,S.a.createElement(x.e,{enableReinitialize:!0,validationSchema:I,initialValues:s,onSubmit:function(e){return G(e)}},(function(t){return S.a.createElement(x.d,null,S.a.createElement("div",{className:"mt-10 mb-20"},S.a.createElement(l,{className:"bold"},"Stay Schedule")),S.a.createElement("div",{className:"form-grid grid-1 mb-20"},S.a.createElement("div",{role:"radiogroup"},H.map((function(a){return S.a.createElement("label",{className:"bold mr-20"},S.a.createElement(x.b,{as:u.a,type:"radio",name:"scheduleType",disabled:!e.regionsList.length,value:a.value,onChange:function(e){t.setFieldValue("scheduleType",e.target.value),M([]),K([]),"final"===e.target.value&&t.values.flexibleScheduleLengthOfStay>0&&(t.setFieldValue("flexibleScheduleLengthOfStay",""),t.setFieldValue("flexibleScheduleStartDate",""),j(0),t.setFieldValue("numberofNights",{IND:0,BTN:0,LKA:0,NPL:0})),"flexible"===e.target.value&&t.values.finalScheduleArrivalDate&&t.values.finalScheduleDepartureDate&&(t.setFieldValue("finalScheduleArrivalDate",""),t.setFieldValue("finalScheduleDepartureDate",""),j(0),t.setFieldValue("numberofNights",{IND:0,BTN:0,LKA:0,NPL:0}))}}),a.label)}))),S.a.createElement(x.a,{name:"scheduleType",render:function(e){return S.a.createElement(l,{className:"text-11",type:"danger"},e)}})),"final"===t.values.scheduleType&&S.a.createElement("section",{className:"finalized-container"},S.a.createElement(C,Object.assign({},t.values,{selectedCountriesAllRegions:B,setFieldValue:t.setFieldValue,setTotalDuration:j}))),"flexible"===t.values.scheduleType&&S.a.createElement("section",{className:"flexible-container"},S.a.createElement(k,Object.assign({},t.values,{selectedCountriesAllRegions:B,setFieldValue:t.setFieldValue}))),t.values.scheduleType?S.a.createElement("section",{className:"flex flex-col"},S.a.createElement(l,{className:"bold mb-10 mt-10"},"Countries"),S.a.createElement("section",{className:"form-grid grid-4 mt-10 flex justify-between"},e.regionsList.map((function(e,a){return S.a.createElement("label",{className:"select-country",htmlFor:e.country.code,key:e.country.code},S.a.createElement("section",null,S.a.createElement("div",{className:"mb-10"},S.a.createElement("img",{src:e.flag,alt:e.country.name})),S.a.createElement(l,{className:"bold"},e.country.name)),S.a.createElement(i.a,{checked:B.find((function(t){return t.code===e.country.code})),id:e.country.code,onChange:function(a){return J(e.country.code,t.values,a)}}))}))),F?S.a.createElement("section",{className:"country-error mt-10 mb-10 text-14 bold"},S.a.createElement("span",null,"At least one country is required")):null,B.map((function(e){return S.a.createElement("section",{className:"flex flex-col mb-10 mt-20",key:"".concat(e.country,"'s regions'")},S.a.createElement(l,{className:"bold mb-10"},e.country," Trip Details"),S.a.createElement("div",{className:"mt-20"},S.a.createElement("div",{className:"flex flex-col mb-20"},S.a.createElement(l,{className:"mb-5 bold"},"Number Of Nights"),S.a.createElement(x.b,{component:L.b,label:"Number of nights ",value:t.values.numberofNights[e.code],name:"numberofNights[".concat(e.code,"]"),type:"number",autoComplete:"off",validate:function(e){return e?e<0?"Invalid number":void 0:"Number of days is required"}}),S.a.createElement(x.a,{name:"numberofNights[".concat(e.code,"]"),render:function(e){return S.a.createElement(l,{className:"text-11",type:"danger"},e)}})),S.a.createElement(l,{className:"mt-10"},"Select Regions"),S.a.createElement("div",{className:"flex "},e.regions&&e.regions.length&&e.regions.map((function(t){return S.a.createElement("div",{className:"select-option mt-20 mb-20 mr-10"},S.a.createElement(i.a,{checked:z[e.code].find((function(e){return e===t.id})),onChange:function(a){return function(e,t,a){var l=z[e];if(a.target.checked&&(l.push(t),K((function(t){return Object(b.a)(Object(b.a)({},t),{},Object(m.a)({},e,Object(f.a)(l)))}))),!a.target.checked){var r=l.filter((function(e){return e!==t}));K((function(t){return Object(b.a)(Object(b.a)({},t),{},Object(m.a)({},e,Object(f.a)(r)))}))}}(e.code,t.id,a)},id:t.id},S.a.createElement("span",{className:"bold"},t.name)))})))))}))):null,S.a.createElement("div",{className:"flex flex-start mb-20 mt-20"},S.a.createElement(r.a,{loading:t.isSubmitting,type:"primary",htmlType:"submit"},t.isSubmitting?"Saving...":"Save & continue")))})))}));t.default=B}}]);